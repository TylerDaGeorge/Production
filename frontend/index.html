<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hybrid Production Scheduler</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; }
        .job { padding: 4px; margin-bottom: 4px; border-bottom: 1px solid #ccc; }
        button { margin-left: 4px; }
    </style>
</head>
<body>
<h1>Job Board</h1>
<p><a href="history.html">View Completed Jobs</a></p>
<div id="jobs">Loading...</div>

<h2>Create Job</h2>
<form id="jobForm">
    <label>Part Number: <input id="part" required></label>
    <button type="submit">Create</button>
</form>

<script>
const API = 'http://localhost:8000';
async function loadJobs() {
    const res = await fetch(`${API}/jobs/`);
    const jobs = await res.json();
    const container = document.getElementById('jobs');
    container.innerHTML = '';
    jobs.forEach(j => {
        const div = document.createElement('div');
        div.className = 'job';
        div.innerHTML = `<strong>${j.part_number || ''}</strong> - ${j.status}`;

        if (j.status === 'unclaimed') {
            const startBtn = document.createElement('button');
            startBtn.textContent = 'Start';
            startBtn.onclick = async () => {
                const user = prompt('Username');
                if(!user) return;
                await fetch(`${API}/jobs/claim`, {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({job_id: j.id, username: user})
                });
                loadJobs();
            };
            div.appendChild(startBtn);
        } else if (j.status === 'running') {
            const finishBtn = document.createElement('button');
            finishBtn.textContent = 'Finish';
            finishBtn.onclick = async () => {
                await fetch(`${API}/jobs/complete`, {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({job_id: j.id})
                });
                loadJobs();
            };
            div.appendChild(finishBtn);
        } else if (j.status === 'finished') {
            const archiveBtn = document.createElement('button');
            archiveBtn.textContent = 'Archive';
            archiveBtn.onclick = async () => {
                await fetch(`${API}/jobs/archive`, {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({job_id: j.id})
                });
                loadJobs();
            };
            div.appendChild(archiveBtn);
        }

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = async () => {
            await fetch(`${API}/jobs/${j.id}`, { method: 'DELETE' });
            loadJobs();
        };
        div.appendChild(deleteBtn);

        container.appendChild(div);
    });
}

document.getElementById('jobForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const part = document.getElementById('part').value;
    await fetch(`${API}/jobs/`, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({part_number: part})
    });
    document.getElementById('part').value = '';
    loadJobs();
});

loadJobs();
</script>
</body>
</html>
