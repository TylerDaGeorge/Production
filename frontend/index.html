<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hybrid Production Scheduler</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; }
        .job { padding: 4px; margin-bottom: 4px; border-bottom: 1px solid #ccc; }
        button { margin-left: 4px; }
    </style>
</head>
<body>
<h1>Job Board</h1>
<div id="jobs">Loading...</div>

<h2>Create Job</h2>
<form id="jobForm">
    <label>Part Number: <input id="part" required></label>
    <button type="submit">Create</button>
</form>

<script>
const API = 'http://localhost:8000';
async function loadJobs() {
    const res = await fetch(`${API}/jobs/`);
    const jobs = await res.json();
    const container = document.getElementById('jobs');
    container.innerHTML = '';
    jobs.forEach(j => {
        const div = document.createElement('div');
        div.className = 'job';
        div.innerHTML = `<strong>${j.part_number || ''}</strong> - ${j.status}`;
        const claimBtn = document.createElement('button');
        claimBtn.textContent = 'Claim';
        claimBtn.onclick = async () => {
            const user = prompt('Username');
            if(!user) return;
            await fetch(`${API}/jobs/claim`, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({job_id: j.id, username: user})
            });
            loadJobs();
        };
        const completeBtn = document.createElement('button');
        completeBtn.textContent = 'Complete';
        completeBtn.onclick = async () => {
            await fetch(`${API}/jobs/complete`, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({job_id: j.id})
            });
            loadJobs();
        };
        div.appendChild(claimBtn);
        div.appendChild(completeBtn);
        container.appendChild(div);
    });
}

document.getElementById('jobForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const part = document.getElementById('part').value;
    await fetch(`${API}/jobs/`, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({part_number: part})
    });
    document.getElementById('part').value = '';
    loadJobs();
});

loadJobs();
</script>
</body>
</html>
